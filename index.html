<!DOCTYPE html>
<html class="dark" lang="zh-Hant">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
    <title>ATE - Aether Trinity Evolution</title>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@200..800&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    
    <!-- Configuration -->
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#5b13ec",
                        "primary-glow": "#7c42ff",
                        "primary-dark": "#3e0ca6",
                        "secondary": "#06b6d4",
                        "background-dark": "#020617",
                        "surface-dark": "#0f172a",
                        "surface-highlight": "#1e293b",
                        "gold": "#D4AF37",
                    },
                    fontFamily: {
                        "display": ["Manrope", "Noto Sans TC", "sans-serif"],
                        "body": ["Noto Sans TC", "Manrope", "sans-serif"],
                    },
                    boxShadow: {
                        "glow": "0 0 20px rgba(91, 19, 236, 0.3)",
                    }
                },
            },
        }
    </script>
    
    <style>
        body { min-height: 100vh; background-color: #020617; -webkit-tap-highlight-color: transparent; overflow-x: hidden; }
        .glass-panel { background: rgba(15, 23, 42, 0.85); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .glass-card { background: linear-gradient(145deg, rgba(255, 255, 255, 0.07) 0%, rgba(255, 255, 255, 0.02) 100%); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); transition: transform 0.2s ease; }
        .glass-card:active { transform: scale(0.98); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .material-symbols-outlined.filled { font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24; }
        .calendar-day-active { background: linear-gradient(135deg, #5b13ec 0%, #4a0db8 100%); box-shadow: 0 4px 12px rgba(91, 19, 236, 0.3); }
        .timer-active { animation: pulse-ring 2s infinite; }
        @keyframes pulse-ring { 0% { box-shadow: 0 0 0 0 rgba(91, 19, 236, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(91, 19, 236, 0); } 100% { box-shadow: 0 0 0 0 rgba(91, 19, 236, 0); } }
        .view-section { display: none; opacity: 0; transition: opacity 0.2s ease; }
        .view-section.active { display: flex; opacity: 1; animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>

<body class="bg-background-dark text-slate-100 font-display selection:bg-primary selection:text-white min-h-screen relative">

    <!-- Global Background -->
    <div class="fixed inset-0 pointer-events-none z-0 overflow-hidden">
        <div class="absolute top-[-10%] left-[20%] w-[80%] h-[50%] bg-primary/20 rounded-full blur-[120px]"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[60%] h-[40%] bg-secondary/10 rounded-full blur-[100px]"></div>
        <div class="absolute inset-0 opacity-[0.03]" style="background-image: url('data:image/svg+xml,%3Csvg viewBox=\'0 0 200 200\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cfilter id=\'noiseFilter\'%3E%3CfeTurbulence type=\'fractalNoise\' baseFrequency=\'0.65\' numOctaves=\'3\' stitchTiles=\'stitch\'/%3E%3C/filter%3E%3Crect width=\'100%25\' height=\'100%25\' filter=\'url(%23noiseFilter)\'/%3E%3C/svg%3E');"></div>
    </div>

    <!-- Main Container -->
    <div class="relative z-10 mx-auto w-full max-w-md min-h-screen bg-black/20 shadow-2xl flex flex-col pb-24">

        <!-- ================= VIEW 1: HUB ================= -->
        <div id="view-hub" class="view-section active flex-col flex-1">
            <header class="pt-14 pb-6 px-6 flex flex-col gap-6">
                <div class="flex justify-between items-start">
                    <div class="flex items-center gap-4">
                        <div class="relative group" onclick="confirmReset()">
                            <div class="relative h-16 w-16 rounded-full border-2 border-white/20 overflow-hidden bg-surface-dark cursor-pointer">
                                <img alt="Profile" class="object-cover w-full h-full" src="https://lh3.googleusercontent.com/aida-public/AB6AXuCAYOzNGEzdDG66QmmNGCUlkdnwk7zJo0-6al0p4StVVrRy7UvwIFfnSbzk1yro93SGmClDJXzHkeK0f3pOKlJ7_0wH9VzNbQ3ATQRP2P4Msi2j3L88v-cPqgWfProkys6HXeVgnOq9poVFtfNyxvn9pqj2xho4IOb0kutPRkMrNn2qgl6IG3CfgZJFN6h_2N_KyQQzgP3uX0T6tGAkUnEDgaVjHUIXMZVxocw3H1i2okCF0BovjWGbicSrh5A42xuvBTiOpnUCuI0"/>
                            </div>
                            <div class="absolute -bottom-1 -right-1 bg-surface-dark rounded-full p-1 border border-white/10">
                                <span class="material-symbols-outlined text-yellow-400 text-[18px] filled">workspace_premium</span>
                            </div>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold tracking-tight text-white leading-none mb-1">覺醒女神</h1>
                            <p class="text-slate-400 text-xs font-medium tracking-wide">LEVEL <span id="hub-level">1</span></p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2 glass-panel px-3 py-1.5 rounded-full">
                        <span class="material-symbols-outlined text-orange-500 text-[20px] filled">local_fire_department</span>
                        <span class="text-sm font-bold text-white"><span id="hub-streak">0</span> Days</span>
                    </div>
                </div>
                <div class="flex flex-col gap-2">
                    <div class="flex justify-between items-end text-xs font-medium text-slate-300">
                        <span>Current XP</span>
                        <span class="text-primary-glow" id="hub-xp-text">0 / 100 XP</span>
                    </div>
                    <div class="h-3 w-full bg-slate-800/50 rounded-full overflow-hidden border border-white/5 backdrop-blur-sm">
                        <div id="hub-xp-bar" class="h-full bg-gradient-to-r from-primary via-purple-500 to-secondary w-[0%] rounded-full shadow-[0_0_15px_rgba(91,19,236,0.5)] transition-all duration-500"></div>
                    </div>
                </div>
            </header>

            <section class="px-6 pb-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-bold text-white tracking-wide flex items-center gap-2">
                        <span class="material-symbols-outlined text-primary text-[20px]">spa</span>三位一體概覽
                    </h2>
                </div>
                <div class="grid grid-cols-1 gap-4">
                    <div onclick="navTo('body')" class="glass-card rounded-2xl p-5 relative overflow-hidden group cursor-pointer active:scale-[0.98] transition-transform">
                        <div class="absolute top-0 right-0 p-4 opacity-10"><span class="material-symbols-outlined text-6xl">accessibility_new</span></div>
                        <div class="flex justify-between items-start mb-4 relative z-10">
                            <div class="flex items-center gap-3">
                                <div class="h-10 w-10 rounded-full bg-rose-500/20 flex items-center justify-center border border-rose-500/30">
                                    <span class="material-symbols-outlined text-rose-400">fitness_center</span>
                                </div>
                                <div><h3 class="text-base font-bold text-white">Body (身)</h3><p class="text-xs text-slate-400">今日完成度</p></div>
                            </div>
                            <div class="flex flex-col items-end"><span id="hub-body-score" class="text-xl font-display font-bold text-white">0%</span></div>
                        </div>
                        <div class="flex items-center gap-3 relative z-10">
                            <div class="flex-1 h-1.5 bg-slate-700/50 rounded-full overflow-hidden">
                                <div id="hub-body-bar" class="h-full bg-rose-500 w-[0%] rounded-full shadow-[0_0_10px_rgba(244,63,94,0.4)] transition-all duration-500"></div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div onclick="navTo('mind')" class="glass-card rounded-2xl p-5 relative overflow-hidden flex flex-col justify-between h-[160px] cursor-pointer">
                            <div class="absolute -bottom-4 -right-4 w-20 h-20 bg-cyan-500/10 rounded-full blur-xl"></div>
                            <div class="flex justify-between items-start">
                                <div class="h-10 w-10 rounded-full bg-cyan-500/20 flex items-center justify-center border border-cyan-500/30">
                                    <span class="material-symbols-outlined text-cyan-400">self_improvement</span>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-base font-bold text-white mb-1">Mind (心)</h3>
                                <p class="text-[10px] text-slate-400">品牌策略 & 正念</p>
                            </div>
                        </div>
                        <div onclick="navTo('calendar')" class="glass-card rounded-2xl p-5 relative overflow-hidden flex flex-col justify-between h-[160px] cursor-pointer">
                            <div class="absolute -bottom-4 -right-4 w-20 h-20 bg-primary/10 rounded-full blur-xl"></div>
                            <div class="flex justify-between items-start">
                                <div class="h-10 w-10 rounded-full bg-primary/20 flex items-center justify-center border border-primary/30">
                                    <span class="material-symbols-outlined text-primary-glow">calendar_month</span>
                                </div>
                            </div>
                            <div>
                                <h3 class="text-base font-bold text-white mb-1">History</h3>
                                <p class="text-[10px] text-slate-400">查看完整紀錄</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- ================= VIEW 2: BODY ================= -->
        <div id="view-body" class="view-section flex-col flex-1 h-full overflow-y-auto no-scrollbar pt-12 px-4 space-y-6">
            <header class="flex items-center justify-between">
                <div>
                    <p class="text-xs font-medium text-slate-400 uppercase tracking-wider mb-1">Aether Trinity Evolution</p>
                    <h1 class="text-2xl font-bold text-white tracking-tight">身體進化</h1>
                </div>
                <!-- Dynamic Date Display -->
                <div class="px-3 py-1 bg-surface-dark border border-white/10 rounded-full text-xs text-primary font-bold" id="body-date-display">Today</div>
            </header>

            <!-- Water -->
            <section class="relative overflow-hidden rounded-2xl glass-panel p-6 shadow-glow border border-primary/20">
                <div class="flex items-start justify-between mb-6">
                    <div>
                        <h2 class="text-lg font-bold flex items-center gap-2 text-white">
                            <span class="material-symbols-outlined text-blue-400">water_drop</span>水分攝入
                        </h2>
                        <p class="text-sm text-slate-400">目標: 1900ml</p>
                    </div>
                    <div class="text-right">
                        <span id="water-val" class="text-3xl font-bold text-white tracking-tight">0</span>
                        <span class="text-sm text-slate-400 font-medium ml-1">ml</span>
                    </div>
                </div>
                <div class="relative h-4 w-full bg-slate-800/50 rounded-full overflow-hidden mb-6">
                    <div id="water-progress" class="absolute top-0 left-0 h-full bg-gradient-to-r from-blue-600 to-primary w-[0%] rounded-full transition-all duration-500"></div>
                </div>
                <div class="flex gap-2 relative z-10">
                    <button onclick="modifyWater(-250)" class="flex items-center justify-center w-12 bg-red-500/20 hover:bg-red-500/30 text-red-300 border border-red-500/30 rounded-xl active:scale-95 transition-transform"><span class="material-symbols-outlined text-base">remove</span></button>
                    <button onclick="modifyWater(250)" class="flex-1 flex items-center justify-center gap-1 bg-primary/20 hover:bg-primary/30 text-white border border-primary/30 h-12 rounded-xl font-semibold text-sm active:scale-95 transition-transform"><span class="material-symbols-outlined text-base">add</span> 250ml</button>
                    <button onclick="modifyWater(500)" class="flex-1 flex items-center justify-center gap-1 bg-primary hover:bg-primary/90 text-white shadow-glow h-12 rounded-xl font-semibold text-sm active:scale-95 transition-transform"><span class="material-symbols-outlined text-base">add</span> 500ml</button>
                </div>
            </section>

            <!-- Tasks -->
            <section>
                <h3 class="text-lg font-bold text-white mb-4 px-1 flex items-center gap-2"><span class="w-1 h-5 bg-primary rounded-full"></span>今日任務</h3>
                <div class="space-y-3" id="task-container"></div>
            </section>

            <!-- Bowel -->
            <section class="pb-6">
                <div class="glass-panel rounded-2xl p-5 flex items-center justify-between border-t border-slate-700/50">
                    <div class="flex items-center gap-3">
                        <div class="h-10 w-10 rounded-full bg-purple-500/10 text-purple-400 flex items-center justify-center"><span class="material-symbols-outlined">gastroenterology</span></div>
                        <div><h4 class="font-bold text-white text-sm">排便確認</h4><p class="text-xs text-slate-400">每日健康監測</p></div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input id="bowel-toggle" class="sr-only peer" type="checkbox" onchange="toggleBowel(this.checked)"/>
                        <div class="w-14 h-8 bg-slate-800 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[4px] after:left-[4px] after:bg-slate-400 after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-primary peer-checked:after:bg-white"></div>
                    </label>
                </div>
            </section>
        </div>

        <!-- ================= VIEW 3: MIND ================= -->
        <div id="view-mind" class="view-section flex-col flex-1 h-full overflow-y-auto no-scrollbar pt-12 px-4">
            <header class="flex items-center justify-between mb-6">
                <h1 class="text-2xl font-bold tracking-wide text-white">心智與靈魂</h1>
            </header>

            <div class="p-1 bg-surface-dark rounded-full flex relative mb-6 border border-white/5">
                <div id="tab-slider" class="absolute left-1 top-1 bottom-1 w-[calc(50%-4px)] bg-primary rounded-full shadow-lg shadow-primary/30 z-0 transition-transform duration-300"></div>
                <button onclick="switchTab('mind')" class="flex-1 relative z-10 py-2.5 text-sm font-bold text-white text-center rounded-full transition-colors" id="btn-mind">心智 (Mind)</button>
                <button onclick="switchTab('spirit')" class="flex-1 relative z-10 py-2.5 text-sm font-medium text-slate-400 hover:text-white text-center rounded-full transition-colors" id="btn-spirit">靈魂 (Spirit)</button>
            </div>

            <!-- Mind Tab Content -->
            <div id="tab-mind" class="space-y-6 animate-fade-in">
                <!-- Reading -->
                <div class="bg-surface-dark rounded-2xl p-6 relative overflow-hidden group border border-white/5">
                    <div class="absolute -top-10 -right-10 w-40 h-40 bg-primary/20 rounded-full blur-3xl"></div>
                    <div class="flex justify-between items-start mb-6 relative z-10">
                        <div>
                            <div class="flex items-center gap-2 mb-1">
                                <span class="material-symbols-outlined text-gold text-lg">menu_book</span>
                                <h2 class="text-sm font-bold tracking-wider uppercase text-gold">深度閱讀</h2>
                            </div>
                            <p class="text-xs text-slate-400">Deep Reading</p>
                        </div>
                        <!-- Manual Complete Checkbox for Reading -->
                        <div class="flex items-center gap-2">
                            <span class="text-[10px] text-slate-400">直接完成</span>
                            <button id="read-check-btn" onclick="toggleReadingCheck()" class="h-8 w-8 rounded-full border border-slate-600 flex items-center justify-center transition-colors">
                                <span class="material-symbols-outlined text-sm">check</span>
                            </button>
                        </div>
                    </div>
                    <div class="flex flex-col items-center justify-center py-4 relative z-10">
                        <div id="read-display" class="text-6xl font-light text-white tracking-tighter tabular-nums font-display">20:00</div>
                        <p class="text-sm text-primary mt-2 font-medium">專注計時 (選用)</p>
                    </div>
                    <div class="flex gap-3 mt-6 relative z-10 justify-center">
                        <button id="read-btn" onclick="toggleReading()" class="w-full bg-primary hover:bg-primary-dark text-white py-3.5 rounded-full font-bold shadow-lg flex items-center justify-center gap-2 active:scale-95 transition-transform">
                            <span class="material-symbols-outlined filled">play_arrow</span>開始計時
                        </button>
                    </div>
                </div>

                <!-- Growth Reflection -->
                <div class="space-y-3">
                    <label class="block text-sm font-medium text-slate-300 pl-2">今日成長反思 <span class="text-slate-500 font-normal ml-2">Growth Reflection</span></label>
                    <div class="relative group">
                        <div class="absolute inset-y-0 left-4 flex items-center pointer-events-none"><span class="material-symbols-outlined text-slate-500">edit_note</span></div>
                        <input id="growth-input" onchange="saveInput('growthNote', this.value)" class="w-full bg-surface-dark border border-white/5 focus:border-primary/50 text-white placeholder-slate-600 pl-12 pr-4 py-4 rounded-xl focus:ring-0 focus:outline-none transition-all shadow-sm" placeholder="寫下今天的核心洞察..." type="text"/>
                    </div>
                </div>

                <!-- Brand Strategy Log (Replaced Carousel) -->
                <div class="space-y-3 pt-2 pb-6">
                    <label class="block text-sm font-medium text-slate-300 pl-2 flex items-center gap-2"><span class="material-symbols-outlined text-primary text-sm">diamond</span> 品牌策略思考 <span class="text-slate-500 font-normal ml-2">Brand Strategy</span></label>
                    <div class="relative group">
                        <textarea id="brand-input" onchange="saveInput('brandNote', this.value)" class="w-full bg-surface-dark border border-white/5 focus:border-primary/50 text-white placeholder-slate-600 px-4 py-4 rounded-xl focus:ring-0 focus:outline-none transition-all shadow-sm resize-none h-32" placeholder="紀錄關於個人品牌的策略想法..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Spirit Tab Content -->
            <div id="tab-spirit" class="space-y-6 animate-fade-in hidden">
                <div class="bg-surface-dark rounded-2xl p-1 border border-white/5">
                    <div class="p-4 border-b border-white/5 pb-2"><h3 class="text-gold font-bold text-base flex items-center gap-2"><span class="material-symbols-outlined text-lg">auto_stories</span>靈修日誌</h3></div>
                    <div class="p-4 space-y-4">
                        <div><label class="text-xs text-slate-400 block mb-1.5 ml-1">經文出處</label><input id="scripture-input" onchange="saveInput('scripture', this.value)" class="w-full bg-surface-highlight border-none text-white placeholder-slate-600 px-4 py-3 rounded-xl focus:ring-1 focus:ring-primary/50 text-sm" placeholder="例如：詩篇 23:1" type="text"/></div>
                        <div><label class="text-xs text-slate-400 block mb-1.5 ml-1">心得筆記</label><textarea id="spirit-input" onchange="saveInput('spiritNote', this.value)" class="w-full bg-surface-highlight border-none text-white placeholder-slate-600 px-4 py-3 rounded-xl focus:ring-1 focus:ring-primary/50 text-sm h-32 resize-none" placeholder="記錄您的領受..."></textarea></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ================= VIEW 4: CALENDAR ================= -->
        <div id="view-calendar" class="view-section flex-col flex-1 h-full overflow-y-auto no-scrollbar pt-12 px-2">
            <header class="flex items-center justify-between px-4 pb-4">
                <div class="flex flex-col"><h1 class="text-2xl font-bold tracking-wide text-white">進化日歷</h1><span class="text-xs text-primary font-medium tracking-widest uppercase opacity-80">Evolution</span></div>
            </header>

            <div class="px-4 pb-2">
                <div class="flex items-center justify-between rounded-2xl bg-surface-dark border border-white/5 p-2 shadow-glass">
                    <button onclick="changeMonth(-1)" class="flex h-10 w-10 items-center justify-center rounded-xl text-slate-400 hover:text-white hover:bg-white/5"><span class="material-symbols-outlined">chevron_left</span></button>
                    <div id="cal-month-display" class="text-center font-bold text-white"></div>
                    <button onclick="changeMonth(1)" class="flex h-10 w-10 items-center justify-center rounded-xl text-slate-400 hover:text-white hover:bg-white/5"><span class="material-symbols-outlined">chevron_right</span></button>
                </div>
            </div>

            <!-- Stats & Grid -->
            <div class="px-4 py-4 grid grid-cols-2 gap-3">
                <div class="flex flex-col items-center justify-center rounded-2xl bg-surface-dark border border-white/5 p-3"><span id="cal-perfect-days" class="text-2xl font-bold text-white">0</span><span class="text-[10px] text-slate-400">完美天數</span></div>
                <div class="flex flex-col items-center justify-center rounded-2xl bg-surface-dark border border-white/5 p-3"><span id="cal-streak" class="text-2xl font-bold text-gold">0</span><span class="text-[10px] text-slate-400">當前連勝</span></div>
            </div>

            <div class="px-4 pb-6">
                <div class="w-full glass-panel rounded-2xl p-4">
                    <div class="grid grid-cols-7 mb-2 text-center text-xs font-medium text-slate-500">
                        <div>日</div><div>一</div><div>二</div><div>三</div><div>四</div><div>五</div><div>六</div>
                    </div>
                    <div id="cal-grid" class="grid grid-cols-7 gap-y-2 gap-x-1 mt-2"></div>
                </div>
            </div>

            <!-- Skool Style Reward -->
            <div class="px-6 pb-6">
                <div class="relative w-full overflow-hidden rounded-2xl bg-gradient-to-br from-[#1f1c27] to-[#131118] border border-white/10 p-6">
                    <div class="flex justify-between items-start">
                        <div class="w-full">
                            <div class="inline-flex items-center gap-1.5 rounded-full bg-gold/10 px-2.5 py-1 text-[10px] font-bold uppercase tracking-wider text-gold mb-2 border border-gold/20">
                                <span class="material-symbols-outlined text-[12px]">star</span>等級 2 解鎖
                            </div>
                            <h3 class="text-lg font-bold text-white">本周神祕驚喜</h3>
                            <p class="text-xs text-slate-400 mt-1">累積 3 個完美天數即可開啟。</p>
                            <div class="mt-3 w-full bg-slate-800 h-2 rounded-full overflow-hidden">
                                <div id="reward-progress" class="bg-gold h-full w-[0%] transition-all duration-500"></div>
                            </div>
                            <p class="text-[10px] text-gold mt-1 text-right"><span id="reward-count">0</span>/3 Days</p>
                        </div>
                    </div>
                    <button id="reward-btn" class="mt-4 w-full py-2.5 rounded-xl text-xs font-bold text-slate-500 bg-slate-800 cursor-not-allowed transition-all" disabled>
                        <span class="flex items-center justify-center gap-1"><span class="material-symbols-outlined text-[16px]">lock</span> 尚未解鎖</span>
                    </button>
                </div>
            </div>

            <!-- Full Detail Overlay -->
            <div id="detail-overlay" class="mx-4 mb-8 glass-panel rounded-2xl p-5 border border-white/10 shadow-2xl relative overflow-hidden transition-all">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-primary to-transparent opacity-50"></div>
                <div class="flex items-center justify-between mb-4">
                    <h3 id="detail-date" class="text-base font-bold text-white">點擊日期查看紀錄</h3>
                </div>
                <div class="space-y-4">
                    <!-- Body Section -->
                    <div class="space-y-2">
                        <h4 class="text-xs text-primary font-bold uppercase tracking-wider">Body</h4>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div class="bg-surface-dark p-2 rounded text-slate-400">水: <span id="detail-water" class="text-white font-bold">-</span></div>
                            <div class="bg-surface-dark p-2 rounded text-slate-400">便: <span id="detail-bowel" class="text-white font-bold">-</span></div>
                        </div>
                        <div id="detail-task-list" class="space-y-1 text-xs"></div>
                    </div>
                    
                    <!-- Mind Section -->
                    <div class="space-y-2">
                        <h4 class="text-xs text-secondary font-bold uppercase tracking-wider">Mind</h4>
                        <div class="bg-surface-dark p-2 rounded text-xs">
                            <span class="text-slate-400 block mb-1">閱讀: <span id="detail-reading" class="text-white">-</span></span>
                            <span class="text-slate-400 block mb-1">成長: <span id="detail-growth" class="text-white italic">-</span></span>
                            <span class="text-slate-400 block">品牌: <span id="detail-brand" class="text-white italic">-</span></span>
                        </div>
                    </div>

                    <!-- Spirit Section -->
                    <div class="space-y-2">
                        <h4 class="text-xs text-gold font-bold uppercase tracking-wider">Spirit</h4>
                        <div class="bg-surface-dark p-2 rounded text-xs">
                            <span class="text-slate-400 block mb-1">經文: <span id="detail-scripture" class="text-white">-</span></span>
                            <span class="text-slate-400 block">心得: <span id="detail-spirit" class="text-white italic">-</span></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ================= BOTTOM NAV ================= -->
        <nav class="fixed bottom-0 left-0 w-full z-50 flex justify-center pb-6 pt-2">
            <div class="glass-panel mx-auto w-[90%] max-w-[380px] rounded-full flex justify-between items-center py-3 px-6 shadow-2xl bg-[#0a0a0c]/90 backdrop-blur-xl border border-white/10">
                <button onclick="navTo('hub')" class="nav-btn flex flex-col items-center gap-1 group w-12" data-target="hub">
                    <span class="material-symbols-outlined text-[24px] text-primary-glow filled" id="icon-hub">dashboard</span>
                    <span class="text-[10px] font-bold text-white" id="text-hub">Hub</span>
                </button>
                <button onclick="navTo('body')" class="nav-btn flex flex-col items-center gap-1 group w-12 opacity-60" data-target="body">
                    <span class="material-symbols-outlined text-[24px] text-slate-300" id="icon-body">accessibility_new</span>
                    <span class="text-[10px] font-medium text-slate-400" id="text-body">Body</span>
                </button>
                <button onclick="navTo('mind')" class="nav-btn flex flex-col items-center gap-1 group w-12 opacity-60" data-target="mind">
                    <span class="material-symbols-outlined text-[24px] text-slate-300" id="icon-mind">psychology</span>
                    <span class="text-[10px] font-medium text-slate-400" id="text-mind">Mind</span>
                </button>
                <button onclick="navTo('calendar')" class="nav-btn flex flex-col items-center gap-1 group w-12 opacity-60" data-target="calendar">
                    <span class="material-symbols-outlined text-[24px] text-slate-300" id="icon-calendar">calendar_month</span>
                    <span class="text-[10px] font-medium text-slate-400" id="text-calendar">Evo</span>
                </button>
            </div>
        </nav>

    </div>

    <!-- Core Logic -->
    <script>
        // --- 1. DATA STORAGE & RESET ---
        const STORAGE_KEY = 'ate_release_v7_final'; 
        const WATER_TARGET = 1900;
        let appState = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
        
        let activeTimers = {}; // { 1: { interval: null, remaining: sec, status: 'idle' } }
        let selectedDateKey = null; // Currently selected date in calendar

        function getTodayKey() {
            const d = new Date();
            return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
        }
        
        const todayKey = getTodayKey();
        
        // Default to today if nothing selected
        if(!selectedDateKey) selectedDateKey = todayKey;

        // Initialize Today (if new)
        if (!appState[todayKey]) {
            appState[todayKey] = { 
                water: 0, 
                bowel: false, 
                tasks: { 1: false, 2: false, 3: false }, 
                readingDone: false, 
                growthNote: "", 
                brandNote: "",
                scripture: "",
                spiritNote: "",
                isPerfect: false 
            };
            saveState();
        }

        function getActiveDateKey() {
            return selectedDateKey || todayKey;
        }

        function saveState() {
            const key = getActiveDateKey();
            const d = appState[key];
            if(d) {
                const tasksDone = d.tasks[1] && d.tasks[2] && d.tasks[3];
                d.isPerfect = (d.water >= WATER_TARGET && tasksDone);
                localStorage.setItem(STORAGE_KEY, JSON.stringify(appState));
                updateUI(); 
            }
        }

        function confirmReset() {
            if(confirm("【系統重置】確定要清除所有紀錄並從 0 開始嗎？")) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        }

        // --- 2. NAVIGATION ---
        function navTo(viewId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + viewId).classList.add('active');
            
            ['hub','body','mind','calendar'].forEach(id => {
                const icon = document.getElementById('icon-' + id);
                const text = document.getElementById('text-' + id);
                const btn = icon.parentElement;
                if (id === viewId) {
                    btn.classList.remove('opacity-60');
                    icon.className = 'material-symbols-outlined text-[24px] text-primary-glow filled';
                    text.className = 'text-[10px] font-bold text-white';
                } else {
                    btn.classList.add('opacity-60');
                    icon.className = 'material-symbols-outlined text-[24px] text-slate-300';
                    text.className = 'text-[10px] font-medium text-slate-400';
                }
            });

            if (viewId === 'body') {
                const display = document.getElementById('body-date-display');
                display.innerText = (selectedDateKey === todayKey) ? "Today" : selectedDateKey;
                if(!appState[selectedDateKey]) {
                    appState[selectedDateKey] = { water: 0, bowel: false, tasks: {1:false,2:false,3:false}, readingDone:false, growthNote:"", isPerfect:false };
                }
                updateUI();
            }

            if(viewId === 'calendar') {
                renderCalendar();
                showDetail(selectedDateKey);
            }
        }

        function switchTab(tab) {
            const mind = document.getElementById('tab-mind');
            const spirit = document.getElementById('tab-spirit');
            const slider = document.getElementById('tab-slider');
            const btnMind = document.getElementById('btn-mind');
            const btnSpirit = document.getElementById('btn-spirit');

            if(tab === 'mind') {
                mind.classList.remove('hidden');
                spirit.classList.add('hidden');
                slider.style.transform = 'translateX(0%)';
                btnMind.classList.replace('text-slate-400', 'text-white');
                btnSpirit.classList.replace('text-white', 'text-slate-400');
            } else {
                mind.classList.add('hidden');
                spirit.classList.remove('hidden');
                slider.style.transform = 'translateX(100%)';
                btnSpirit.classList.replace('text-slate-400', 'text-white');
                btnMind.classList.replace('text-white', 'text-slate-400');
            }
        }

        // --- 3. BODY LOGIC ---
        function modifyWater(amount) {
            const k = getActiveDateKey();
            if(!appState[k]) return;
            if (appState[k].water + amount < 0) return;
            appState[k].water += amount;
            saveState();
        }

        function toggleBowel(checked) {
            const k = getActiveDateKey();
            appState[k].bowel = checked;
            saveState();
        }

        function toggleTask(id) {
            const k = getActiveDateKey();
            appState[k].tasks[id] = !appState[k].tasks[id];
            
            // Sync timer state logic if toggled manually
            if (!appState[k].tasks[id] && activeTimers[id]) {
                clearInterval(activeTimers[id].interval);
                activeTimers[id].status = 'idle';
                activeTimers[id].remaining = activeTimers[id].total;
            } else if (appState[k].tasks[id] && activeTimers[id]) {
                clearInterval(activeTimers[id].interval);
                activeTimers[id].status = 'done';
            }
            saveState();
        }

        // --- FIXED ZERO-LATENCY TIMER ---
        function toggleTimer(id, duration) {
            if (!activeTimers[id]) {
                activeTimers[id] = { remaining: duration, status: 'idle', interval: null, total: duration };
            }
            const t = activeTimers[id];
            
            if (t.status === 'running') {
                // PAUSE
                clearInterval(t.interval);
                t.status = 'paused';
            } else {
                // START / RESUME
                t.status = 'running';
                if (t.interval) clearInterval(t.interval);
                t.interval = setInterval(() => {
                    t.remaining--;
                    // Direct DOM Update for performance
                    const m = Math.floor(t.remaining / 60);
                    const s = t.remaining % 60;
                    const display = document.getElementById(`t-display-${id}`);
                    if(display) display.innerText = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
                    
                    if (t.remaining <= 0) {
                        clearInterval(t.interval);
                        t.status = 'done';
                        const k = getActiveDateKey();
                        appState[k].tasks[id] = true;
                        saveState(); 
                    }
                }, 1000);
            }
            renderTasks(); // Update Button State immediately
        }

        function renderTasks() {
            const k = getActiveDateKey();
            const d = appState[k];
            const container = document.getElementById('task-container');
            if(!d) return;

            const tasks = [
                { id: 1, type: 'timer', title: "深蹲練習 (15m)", sub: "核心肌群", icon: "fitness_center", dur: 900 }, 
                { id: 2, type: 'timer', title: "阻力訓練 (30m)", sub: "全身肌力", icon: "exercise", dur: 1800 }, 
                { id: 3, type: 'check', title: "DIAAS 酸奶早餐", sub: "建議 08:30 AM", icon: "restaurant" }
            ];

            let html = '';
            tasks.forEach(t => {
                const isDone = d.tasks[t.id];
                
                if (isDone) {
                    html += `
                    <div class="group flex items-center gap-4 p-4 rounded-2xl glass-panel border border-primary/50 shadow-glow cursor-pointer transition-all" onclick="toggleTask(${t.id})">
                        <div class="flex-shrink-0 h-12 w-12 rounded-full bg-primary/20 text-primary flex items-center justify-center border border-primary/30"><span class="material-symbols-outlined">check</span></div>
                        <div class="flex-1">
                            <h4 class="font-bold text-white text-lg line-through decoration-primary/50">${t.title}</h4>
                            <p class="text-xs text-primary">已完成 (點擊取消)</p>
                        </div>
                    </div>`;
                } else if (t.type === 'check') {
                    html += `
                    <div class="group flex items-center gap-4 p-4 rounded-2xl bg-surface-dark border border-slate-800 hover:border-slate-700 transition-colors">
                        <div class="flex-shrink-0 h-12 w-12 rounded-full bg-slate-800 text-slate-400 flex items-center justify-center" onclick="toggleTask(${t.id})"><span class="material-symbols-outlined">${t.icon}</span></div>
                        <div class="flex-1"><h4 class="font-bold text-slate-300 text-lg">${t.title}</h4><p class="text-xs text-slate-500">${t.sub}</p></div>
                        <button onclick="toggleTask(${t.id})" class="h-10 w-10 rounded-full bg-slate-700 text-white flex items-center justify-center shadow-lg active:scale-95"><span class="material-symbols-outlined">done</span></button>
                    </div>`;
                } else {
                    // Timer Task
                    let m = Math.floor(t.dur / 60);
                    let s = 0;
                    let isRunning = false;
                    
                    if (activeTimers[t.id]) {
                        m = Math.floor(activeTimers[t.id].remaining / 60);
                        s = activeTimers[t.id].remaining % 60;
                        isRunning = activeTimers[t.id].status === 'running';
                    }

                    const timeStr = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
                    const btnIcon = isRunning ? 'pause' : 'play_arrow';
                    const btnClass = isRunning ? 'bg-white text-primary' : 'bg-primary text-white';
                    const glowClass = isRunning ? 'border-primary/50 timer-active' : 'border-slate-800';

                    html += `
                    <div class="group flex items-center gap-4 p-4 rounded-2xl bg-surface-dark border ${glowClass} transition-all">
                        <div class="flex-shrink-0 h-12 w-12 rounded-full flex items-center justify-center bg-slate-800 text-slate-400 cursor-pointer border border-transparent hover:border-slate-600" onclick="toggleTask(${t.id})">
                            <span class="material-symbols-outlined">${t.icon}</span>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-bold text-white text-lg">${t.title}</h4>
                            <span id="t-display-${t.id}" class="font-mono text-xl font-bold text-slate-300">${timeStr}</span>
                        </div>
                        <button onclick="toggleTimer(${t.id}, ${t.dur})" class="h-10 w-10 rounded-full flex items-center justify-center shadow-lg ${btnClass} active:scale-95 transition-transform">
                            <span class="material-symbols-outlined">${btnIcon}</span>
                        </button>
                    </div>`;
                }
            });
            container.innerHTML = html;
        }

        // --- 4. MIND ---
        let readInterval = null;
        let readTime = 1200; 
        let readRunning = false;

        function toggleReading() {
            const btn = document.getElementById('read-btn');
            const display = document.getElementById('read-display');
            
            if (readRunning) {
                clearInterval(readInterval);
                readRunning = false;
                btn.innerHTML = '<span class="material-symbols-outlined filled">play_arrow</span>繼續';
                btn.className = "w-full bg-primary hover:bg-primary-dark text-white py-3.5 rounded-full font-bold shadow-lg flex items-center justify-center gap-2";
            } else {
                readRunning = true;
                btn.innerHTML = '<span class="material-symbols-outlined filled">pause</span>暫停';
                btn.className = "w-full bg-white text-primary py-3.5 rounded-full font-bold shadow-lg flex items-center justify-center gap-2";
                readInterval = setInterval(() => {
                    readTime--;
                    const m = Math.floor(readTime / 60);
                    const s = readTime % 60;
                    display.innerText = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
                    if(readTime <= 0) { 
                        clearInterval(readInterval); 
                        readRunning = false; 
                        btn.innerText = "完成";
                        toggleReadingCheck(true);
                    }
                }, 1000);
            }
        }

        function toggleReadingCheck(forceState) {
            const k = getActiveDateKey();
            if (forceState !== undefined) {
                appState[k].readingDone = forceState;
            } else {
                appState[k].readingDone = !appState[k].readingDone;
            }
            saveState();
        }

        function saveInput(field, value) {
            const k = getActiveDateKey();
            appState[k][field] = value;
            localStorage.setItem(STORAGE_KEY, JSON.stringify(appState));
            // Update Detail View immediately if open
            if(document.getElementById('view-calendar').classList.contains('active')) showDetail(k);
        }

        // --- 5. CALENDAR ---
        let calViewDate = new Date();
        
        function renderCalendar() {
            const year = calViewDate.getFullYear();
            const month = calViewDate.getMonth();
            const today = new Date();
            
            const mNames = ["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"];
            document.getElementById('cal-month-display').innerText = `${year}年 ${mNames[month]}`;

            const firstDay = new Date(year, month, 1).getDay();
            const daysInM = new Date(year, month + 1, 0).getDate();
            const isCurrM = today.getFullYear() === year && today.getMonth() === month;

            let html = '';
            for(let i=0; i<firstDay; i++) html += `<div></div>`;

            let perfectCount = 0;

            for(let d=1; d<=daysInM; d++) {
                const dateKey = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const entry = appState[dateKey];
                const isPerfect = entry && entry.isPerfect;
                const isToday = isCurrM && d === today.getDate();
                const isSelected = dateKey === selectedDateKey;
                
                if(isPerfect) perfectCount++;

                let css = "aspect-square flex flex-col items-center justify-center rounded-xl transition-all cursor-pointer border-2 ";
                if (isSelected) css += "border-white bg-white/10 text-white ";
                else if (isToday) css += "border-primary bg-primary/20 text-white ";
                else if (isPerfect) css += "calendar-day-active text-white shadow-glow border-transparent ";
                else css += "border-transparent hover:bg-white/5 text-slate-400 ";

                html += `<div class="${css}" onclick="selectDate('${dateKey}')">
                            <span class="text-sm font-bold">${d}</span>
                            ${isPerfect && !isSelected ? '<span class="w-1 h-1 bg-white rounded-full mt-1"></span>' : ''}
                         </div>`;
            }
            document.getElementById('cal-grid').innerHTML = html;
            
            // Stats & Reward
            document.getElementById('cal-perfect-days').innerText = perfectCount;
            document.getElementById('cal-streak').innerText = perfectCount > 0 ? 1 : 0;
            
            const progress = Math.min(perfectCount, 3);
            const pct = (progress / 3) * 100;
            document.getElementById('reward-count').innerText = progress;
            document.getElementById('reward-progress').style.width = `${pct}%`;
            
            const rBtn = document.getElementById('reward-btn');
            if(progress >= 3) {
                rBtn.disabled = false;
                rBtn.className = "mt-4 w-full py-2.5 rounded-xl text-xs font-bold text-white bg-gradient-to-r from-gold to-yellow-500 shadow-glow animate-pulse active:scale-95 transition-transform";
                rBtn.innerHTML = '<span class="material-symbols-outlined text-[16px]">redeem</span> 點擊領取獎勵';
                rBtn.onclick = () => alert("恭喜！您已解鎖 VIP 課程與獨家資源！");
            } else {
                rBtn.disabled = true;
                rBtn.className = "mt-4 w-full py-2.5 rounded-xl text-xs font-bold text-slate-500 bg-slate-800 cursor-not-allowed";
                rBtn.innerHTML = `<span class="flex items-center justify-center gap-1"><span class="material-symbols-outlined text-[16px]">lock</span> 尚未解鎖</span>`;
            }
        }

        function changeMonth(offset) {
            calViewDate.setMonth(calViewDate.getMonth() + offset);
            renderCalendar();
        }

        function selectDate(dateKey) {
            selectedDateKey = dateKey;
            if (!appState[dateKey]) {
                appState[dateKey] = { water: 0, bowel: false, tasks: { 1: false, 2: false, 3: false }, readingDone: false, growthNote: "", brandNote: "", scripture: "", spiritNote: "", isPerfect: false };
            }
            renderCalendar();
            showDetail(dateKey);
        }

        function showDetail(dateKey) {
            const entry = appState[dateKey];
            const [y, m, d] = dateKey.split('-');
            
            document.getElementById('detail-date').innerText = `${m}月 ${d}日 完整紀錄`;
            document.getElementById('detail-water').innerText = `${entry.water} ml`;
            document.getElementById('detail-bowel').innerText = entry.bowel ? '正常' : '無';
            document.getElementById('detail-bowel').className = entry.bowel ? 'font-bold text-green-400' : 'font-bold text-slate-500';
            
            let taskHtml = '';
            taskHtml += `<div class="flex justify-between text-slate-300"><span>深蹲</span><span class="${entry.tasks[1]?'text-primary':'text-slate-600'}">${entry.tasks[1]?'完成':'未完成'}</span></div>`;
            taskHtml += `<div class="flex justify-between text-slate-300"><span>阻力</span><span class="${entry.tasks[2]?'text-primary':'text-slate-600'}">${entry.tasks[2]?'完成':'未完成'}</span></div>`;
            taskHtml += `<div class="flex justify-between text-slate-300"><span>早餐</span><span class="${entry.tasks[3]?'text-primary':'text-slate-600'}">${entry.tasks[3]?'完成':'未完成'}</span></div>`;
            document.getElementById('detail-task-list').innerHTML = taskHtml;
            
            // Mind & Spirit Text
            document.getElementById('detail-reading').innerText = entry.readingDone ? '完成' : '未完成';
            document.getElementById('detail-reading').className = entry.readingDone ? 'text-primary' : 'text-slate-600';
            
            document.getElementById('detail-growth').innerText = entry.growthNote || "(無)";
            document.getElementById('detail-brand').innerText = entry.brandNote || "(無)";
            document.getElementById('detail-scripture').innerText = entry.scripture || "(無)";
            document.getElementById('detail-spirit').innerText = entry.spiritNote || "(無)";
            
            const card = document.getElementById('detail-overlay');
            card.classList.remove('border-white/10');
            card.classList.add('border-primary');
            setTimeout(() => { card.classList.remove('border-primary'); card.classList.add('border-white/10'); }, 300);
        }

        // --- 6. GLOBAL UPDATE ---
        function updateUI() {
            const k = getActiveDateKey();
            const d = appState[k];
            if(!d) return;

            // Body
            const waterVal = document.getElementById('water-val');
            const waterProg = document.getElementById('water-progress');
            const bowelTog = document.getElementById('bowel-toggle');
            
            if(waterVal) waterVal.innerText = d.water;
            if(waterProg) {
                const wPct = Math.min((d.water / WATER_TARGET) * 100, 100);
                waterProg.style.width = `${wPct}%`;
            }
            if(bowelTog) bowelTog.checked = d.bowel;
            
            // Mind
            const readBtn = document.getElementById('read-check-btn');
            if(readBtn) readBtn.className = d.readingDone ? "h-8 w-8 rounded-full bg-primary text-white flex items-center justify-center transition-colors shadow-glow" : "h-8 w-8 rounded-full border border-slate-600 flex items-center justify-center transition-colors text-slate-600";
            
            if(document.getElementById('growth-input')) document.getElementById('growth-input').value = d.growthNote || "";
            if(document.getElementById('brand-input')) document.getElementById('brand-input').value = d.brandNote || "";
            if(document.getElementById('scripture-input')) document.getElementById('scripture-input').value = d.scripture || "";
            if(document.getElementById('spirit-input')) document.getElementById('spirit-input').value = d.spiritNote || "";

            renderTasks();

            // Hub
            const tCount = (d.tasks[1]?1:0) + (d.tasks[2]?1:0) + (d.tasks[3]?1:0);
            const totalScore = Math.round(((d.water/WATER_TARGET)*0.4 + (tCount/3)*0.6) * 100);
            const hubScore = document.getElementById('hub-body-score');
            const hubBar = document.getElementById('hub-body-bar');
            if(hubScore) hubScore.innerText = `${Math.min(totalScore, 100)}%`;
            if(hubBar) hubBar.style.width = `${Math.min(totalScore, 100)}%`;
            
            // Calendar
            if (document.getElementById('view-calendar').classList.contains('active')) {
                renderCalendar();
                showDetail(k);
            }
        }

        // Init
        updateUI();
        navTo('hub');

    </script>
</body>
</html>
